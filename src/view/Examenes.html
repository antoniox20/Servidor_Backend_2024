<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Examen de Inglés</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/examen.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <header>
        <nav class="navbar navbar-dark bg-dark">
            <div class="container">
                <span class="navbar-brand mb-0 h1"><i class="fas fa-book"></i> Crear Examen de Inglés</span>
                <button class="btn btn-primary ml-auto" onclick="goBack()">Volver</button>
            </div>
        </nav>
    </header>
    <main class="container mt-4">
        <form id="crearExamenForm">
            <div class="form-group">
                <label for="titulo"><i class="fas fa-heading"></i> Título del Examen</label>
                <input type="text" class="form-control" id="titulo" name="titulo" required>
            </div>
            <div class="form-group">
                <label for="descripcion"><i class="fas fa-align-left"></i> Descripción del Examen</label>
                <textarea class="form-control" id="descripcion" name="descripcion" rows="3" required></textarea>
            </div>
            <div class="form-group">
                <label for="tema"><i class="fas fa-bookmark"></i> Tema</label>
                <select class="form-control" id="tema" name="tema" required>
                    <option value="" disabled selected>Seleccione un tema</option>
                    <option value="present_simple">Present Simple</option>
                    <option value="present_continuous">Present Continuous</option>
                    <option value="past_simple">Past Simple</option>
                    <option value="past_continuous">Past Continuous</option>
                    <option value="present_perfect">Present Perfect</option>
                    <option value="past_perfect">Past Perfect</option>
                    <option value="future_tenses">Future Tenses</option>
                    <option value="conditionals">Conditionals</option>
                    <option value="passive_voice">Passive Voice</option>
                    <option value="speech">Speech</option>
                    <option value="modals">Modals</option>
                    <option value="relative_clauses">Relative Clauses</option>
                    <option value="gerunds_infinitives">Gerunds and Infinitives</option>
                    <option value="phrasal_verbs">Phrasal Verbs</option>
                    <option value="comparatives_superlatives">Comparatives and Superlatives</option>
                </select>
            </div>
            <div class="form-group">
                <label for="libro"><i class="fas fa-book"></i> Libro</label>
                <select class="form-control" id="libro" name="libro" required>
                    <option value="" disabled selected>Seleccione un libro</option>
                    <option value="1">Libro 1</option>
                    <option value="2">Libro 2</option>
                    <option value="3">Libro 3</option>
                    <option value="4">Libro 4</option>
                    <option value="5">Libro 5</option>
                    <option value="6">Libro 6</option>
                    <option value="7">Libro 7</option>
                    <option value="8">Libro 8</option>
                    <option value="9">Libro 9</option>
                    <option value="10">Libro 10</option>
                    <option value="11">Libro 11</option>
                    <option value="12">Libro 12</option>
                    <option value="13">Libro 13</option>
                    <option value="14">Libro 14</option>
                    <option value="15">Libro 15</option>
                    <option value="16">Libro 16</option>
                    <option value="17">Libro 17</option>
                    <option value="18">Libro 18</option>
                    <option value="19">Libro 19</option>
                    <option value="20">Libro 20</option>
                    <option value="21">Libro 21</option>
                    <option value="22">Libro 22</option>
                    <option value="23">Libro 23</option>
                    <option value="24">Libro 24</option>
                    <option value="25">Libro 25</option>
                    <option value="26">Libro 26</option>
                    <option value="27">Libro 27</option>
                    <option value="28">Libro 28</option>
                    <option value="29">Libro 29</option>
                    <option value="30">Libro 30</option>
                </select>
            </div>
            <div class="form-group">
                <label for="tiposPreguntas"><i class="fas fa-question-circle"></i> Tipos de preguntas</label>
                <div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="opcionMultiple" id="opcionMultiple" name="tiposPreguntas">
                        <label class="form-check-label" for="opcionMultiple">
                            Opción múltiple
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="verdaderoFalso" id="verdaderoFalso" name="tiposPreguntas">
                        <label class="form-check-label" for="verdaderoFalso">
                            Verdadero o falso
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="listening" id="listening" name="tiposPreguntas">
                        <label class="form-check-label" for="listening">
                            Listening
                        </label>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="numeroOpciones"><i class="fas fa-list-ol"></i> Número de opciones</label>
                <input type="number" class="form-control" id="numeroOpciones" name="numeroOpciones" min="2" max="5" value="3">
            </div>
            <div class="form-group">
                <label for="dificultad"><i class="fas fa-signal"></i> Nivel</label>
                <select class="form-control" id="dificultad" name="dificultad" required>
                    <option value="facil">Básico</option>
                    <option value="medio">Intermedio</option>
                    <option value="dificil">Avanzado</option>
                </select>
            </div>
            <div class="form-group">
                <label for="fechaCreacion"><i class="fas fa-calendar-alt"></i> Fecha de Creación</label>
                <input type="date" class="form-control" id="fechaCreacion" name="fechaCreacion">
            </div>
            <div class="form-group">
                <label for="tiempo"><i class="fas fa-clock"></i> Tiempo (en minutos)</label>
                <input type="number" class="form-control" id="tiempo" name="tiempo" required>
            </div>
            <button type="submit" class="btn btn-primary"><i class="fas fa-check-circle"></i> Generar preguntas</button>
        </form>
    </main>
    <footer class="bg-dark text-white text-center py-3 mt-4">
        <p class="mb-0">&copy; 2024 Escuela de Idiomas del Ejército</p>
    </footer>

    <!-- Modals for success and error messages -->
    <div class="modal" tabindex="-1" id="successModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <i class="fas fa-check-circle fa-3x text-success"></i>
                    <p class="mt-3 text-dark">¡Examen creado exitosamente!</p>
                </div>
            </div>
        </div>
    </div>
    <div class="modal" tabindex="-1" id="errorModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <i class="fas fa-times-circle fa-3x text-danger"></i>
                    <p class="mt-3 text-dark">Error al crear el examen. Por favor, intente nuevamente.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function goBack() {
            window.location.href = 'index.html';
        }

        $(document).ready(function() {
            $('#crearExamenForm').submit(function(e) {
                e.preventDefault();
                const formData = $(this).serializeArray();
                const fechaCreacionInput = $('#fechaCreacion').val();
                if (!fechaCreacionInput) {
                    const today = new Date().toISOString().split('T')[0];
                    formData.push({ name: 'fechaCreacion', value: today });
                }

                // Obtener los tipos de preguntas seleccionados
                const tiposPreguntas = [];
                $('input[name="tiposPreguntas"]:checked').each(function() {
                    tiposPreguntas.push($(this).val());
                });

                formData.push({ name: 'tiposPreguntas', value: tiposPreguntas });
                formData.push({ name: 'contenidoHTML', value: document.documentElement.outerHTML });

                $.ajax({
                    type: 'POST',
                    url: 'http://localhost:3000/generarExamen',
                    data: formData,
                    success: function(response) {
                        // Mostrar modal de éxito
                        $('#successModal').modal('show');
                        // Limpiar el formulario
                        $('#crearExamenForm')[0].reset();
                        // Almacenar datos en localStorage
                        localStorage.setItem('preguntas', JSON.stringify(response.preguntas));
                        localStorage.setItem('token', response.token);
                        localStorage.setItem('tiempo', response.tiempo); 
                        // Ocultar el modal después de unos segundos
                        setTimeout(() => {
                            $('#successModal').modal('hide');
                        }, 2000);
                    },
                    error: function(xhr, status, error) {
                        // Mostrar modal de error
                        $('#errorModal').modal('show');
                        // Ocultar el modal después de unos segundos
                        setTimeout(() => {
                            $('#errorModal').modal('hide');
                        }, 2000);
                    }
                });
            });
        });
    </script>
</body>
</html>
